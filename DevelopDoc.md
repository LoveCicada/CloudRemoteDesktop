
# 云桌面开发设计


![设计框架](./img/framework.png)

### RDP登录/后台服务
- 目的
Windows在账号未激活的情况下，无法进行截屏，需要登录后开启相应的后台服务支持客户端的连接
- 任务
1.封装相应的RDP登录模块
2.验证Windows上如何实现后台程序的开启
3.实现完整的流程，使用Windows账号密码能在另一台机器上通过RDP连接登录上对应的机器，并启动相应的后台程序
4.不要求后台程序的功能，程序能自动启动即可
- 资料
https://github.com/FreeRDP/FreeRDP

### WebRTC传输
- 目的
1.低延迟的视音频传输
2.适配浏览器用户

### 屏幕捕获/音频捕获/显卡编码
- 目的
屏幕和音频捕获

- 任务
1.实现屏幕编码数据稳定帧率的输出
2.使用DXGI实现屏幕捕获功能，并直接调用NVIDIA显卡编码
3.实现音频捕获提供连续的音频输出功能
4.实现完整的流程使用样例程序，把当前屏幕的内容和音频录制为媒体文件

- 难点
HDR截屏

### 显卡解码/实时渲染/音频设备输出
- 目的
云桌面客户端的基本必备功能

- 任务
1.调用NVIDIA显卡解码支持相应的解码数据直接渲染
2.实现完整的流程为简易播放器软件，支持播放特定的媒体文件进行实时的画面显示
和同步的音频声音输出，窗口需支持按任意幅面缩放，最大化，缩放必须包含如下算法：
水平对齐，垂直对齐，拉伸
3.后续会有封装要求，所以前期流程代码的实现需充分考虑整个流程的模块划分
4.开发平台使用QT，渲染引擎使用OpenGL

### 远程键盘鼠标控制
- 目标
云桌面客户端操作控制的基本必备功能

- 任务
1.键盘/鼠标操作的定义
2.客户端和服务端的简单通信
3.控制当前桌面鼠标的移动，实现键盘的虚拟按键操作（包括组合键）
4.捕获当前窗口程序中键盘的消息，当前窗口鼠标的消息

- 要求
1.在被控制的机器（服务端）上启动一个后台程序，在进行控制的机器（客户端）
上启动一个窗口程序
2.客户端窗口程序启动时支持设置窗口的大小，需考虑与当前屏幕的适配，
例如设置大小超过当前窗口大小
3.客户端窗口程序支持按任意幅面缩放（可设定最小幅面），最大化操作，
缩放需考虑：水平对齐，垂直对齐，拉伸
4.当鼠标在客户端的窗口内移动时，相应的远端鼠标也跟随移动，移动到边缘位置时，x
需要有一定强度的吸附效果，移动时的映射关系需考虑缩放时使用的算法，同时在当前窗口
是焦点时使用键盘操作，远端也能同样的响应

### 资料

[RDP](https://github.com/FreeRDP/FreeRDP)

[远程键盘鼠标控制-VNC](https://github.com/ultravnc/UltraVNC)

[FreeRDP-Manuals](https://github.com/awakecoding/FreeRDP-Manuals/blob/master/User/FreeRDP-User-Manual.markdown)

[Windows编译FreeRDP](https://blog.csdn.net/defaultbyzt/article/details/108099252)
